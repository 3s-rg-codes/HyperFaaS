syntax = "proto3";
package common;
option go_package = "github.com/3s-rg-codes/HyperFaaS/proto/common";

message Error {
  string message = 1;
}

message Image {
  string tag = 1;
}

message CallRequest {
  // The unique identifier of the function to invoke.
  string function_id = 1;
  // The data to pass to the function.
  bytes data = 2;
}
  
message CallResponse {
  // The result data from the function call.
  bytes data = 1;
  // An error that happened in the function (the user code), if any.
  Error error = 2;
}

message Config {
  // container memory limit in bytes
  int64 memory = 1;
  CPUConfig cpu = 2;
  int32 timeout = 3;
  int32 max_concurrency = 4;
}

// Container CPU configuration. 
// If the host has 2 CPUs and the container should only use 1 CPU,
// set period to 100000 and quota to 50000.
message CPUConfig {
  // CPU CFS (Completely Fair Scheduler) period
  int64 period = 1;
  // CPU CFS (Completely Fair Scheduler) quota
  int64 quota = 2;
}

message CreateFunctionRequest {
  Image image = 1;
  Config config = 2;
}

message CreateFunctionResponse {
  string function_id = 1;
}

message StateRequest {

}
// StateResponse is used to report an event in relation to a function_id.
// It may be that a downstream node now has an instance for the function,
// or no longer has an instance. 
// This is used to propagate state changes to the routing controller.
message StateResponse {
  string function_id = 1;
  bool have = 2;
}